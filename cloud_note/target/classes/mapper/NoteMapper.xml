<?xml version="1.0" encoding="UTF-8" ?>
<!-- XXXMapper.xml 在entity 包中  -->  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"   
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<!--
 	namespace 的值是 XXXMapper 接口
 	 每个Mapper 接口对应一个配置文件  
  -->
<mapper namespace="dao.NoteDao">
	<select id="findByIds"
		resultType="entity.Note">
		select * from note where note_book_id=#{note_book_id} 
			and note_status_id in(1,4)
	</select>
	<select id="loadNoteContent" parameterType="String"
		resultType="String">
		select note_content from note where note_id = #{note_id}	
	</select>
	<update id="updateNote" parameterType="entity.Note">
		update note set note_content = #{note_content} , note_title = #{note_title} ,
					 	updated_at = UNIX_TIMESTAMP(#{updated_at})
						where note_id = #{note_id}
	</update>
	<insert id="addNote" parameterType="entity.Note">
		insert into note(note_id , note_book_id , user_id ,
							note_status_id , note_type_id , note_title ,
							created_at , note_content)
				values (#{note_id} , #{note_book_id} , #{user_id} ,
							#{note_status_id} , #{note_type_id} , #{note_title} ,
							UNIX_TIMESTAMP(#{created_at}) , #{note_content} )
	</insert>
	<delete id="deleteNote" parameterType="String">
		delete from note where note_id = #{note_id}
	</delete>
	<update id="starNote" parameterType="String">
		update note set note_status_id = 4 where note_id = #{note_id}
	</update>
	<update id="unstarNote" parameterType="String">
		update note set note_status_id = 1 where note_id = #{note_id}
	</update>
	<update id="moveNote">
		update note set note_book_id = #{note_book_id} , updated_at = #{updated_at}
		where note_id = #{note_id}
	</update>
	<update id="moveToTrush" parameterType="String">
		update note set note_status_id = 2 where note_id = #{note_id}
	</update>
	<select id="searchNotes" resultType="entity.Note">
		select * from note where user_id = #{user_id} and note_title like #{note_title}	
	</select>
	<select id="trash" parameterType="String" resultType="entity.Note">
		select * from note where user_id = #{user_id} and note_status_id = 2;
	</select>
	<select id="loadNotes" resultMap="">
		select note_id , note_title , note_status_id , note_type_id , 
			   note.created_at , note.updated_at , note_book_name 
				from note inner join note_book 
				on note.note_book_id = note_book.note_book_id
				where note_status_id = #{note_status_id} and note.user_id = #{user_id}
	</select>
	<resultMap type="" id="note_info"></resultMap>
</mapper>